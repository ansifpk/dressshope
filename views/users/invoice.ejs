<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <!-- Custom Style -->
    <link rel="stylesheet" href="assets/css/invoice.css">

    <title>Invoice..!</title>
</head>
<body>
    <div class="my-5 page" size="A4">
        <div class="p-5">
            <section class="store-user mt-5">
                <div class="col-12">
                    <div class="row bb pb-3">
                        <div class="col-7">
                            <h2>Fasionstore Dress</h2>
                            <p class="address"> Malappuram, <br> Kerala, <br>India </p>
                            <div class="txn mt-2">Ph: 7994326541</div>
                        </div>
                        <div class="col-5">
                            <h2>Client Detailes</h2>
                            <p class="address"> <%=orderData.userId.name%>, <br> Kerala, <br>India </p>
                            <div class="txn mt-2">Ph: <%=orderData.userId.mobile%></div>
                        </div>
                    </div>
                    <div class="row extra-info pt-3">
                        <div class="col-7">
                            <p>Payment Method: <span><%=orderData.products[0].paymentMethod%></span></p>
                            <p>Order Number: <span><%=orderData._id%></span></p>
                        </div>
                        <div class="col-5">
                            <p>Order Date: <span><%=orderData.createdAt.toLocaleDateString()%></span></p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="product-area mt-4">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <td>Item Name</td>
                            <td>Price</td>
                            <td>Quantity</td>
                            <td>Total</td>
                        </tr>
                    </thead>
                    <tbody>
                        <%
                        let offerCheck ;
                         %>
                        <%
                          orderData.products
                          .filter((order)=>order.productStatus == "pending" || order.productStatus == "Delivered" || order.productStatus == "returnPending")
                          .forEach((order)=>{
                              offerCheck =  offer.find((value)=>value.iteam == order.productId.name)
                              if (offerCheck) {
                                console.log(total,"1");
                                total = Math.floor( total - order.productId.Price*(offerCheck.offerRate/100))
                                console.log(total,"2");
                             }
                             
                            %>
                              <tr>
                                    <td>
                                        <div class="media">
                                            <div class="media-body">
                                                <p class="mt-0 title"><%=order.productId.name%></p>                                            </div>
                                        </div>
                                    </td>
                                    <td>Rs. <%= offerCheck ? Math.floor( order.productId.Price - order.productId.Price*(offerCheck.offerRate/100)) :order.productId.Price %></td>
                                    <td><%=order.quandity%></td>
                                    <td>Rs. <%=  offerCheck ? Math.floor( (order.productId.Price - order.productId.Price*(offerCheck.offerRate/100)))*order.quandity :order.productId.Price * order.quandity%></td>
                                </tr>
                          <%})
                        %>
                    </tbody>
                </table>
            </section>

            <section class="balance-info">
                <div class="row">
                     <div class="col-8">
                     </div>
                    <div class="col-4">
                        <table class="table border-1 table-hover">
                            <tr>
                                <td>Total:</td>
                                <td>Rs. <%=total%></td>
                            </tr>
                            <tr>
                                <td>Discount:</td>
                                <td>Rs. <%=orderData.couponOfferPrice%></td>
                            </tr>
                            <tfoot>
                                <tr>
                                    <td>Grand Total:</td>
                                    <td>Rs. <%=total - orderData.couponOfferPrice %></td>
                                </tr>
                            </tfoot>
                        </table>

                        
                    </div>
                </div>
            </section>
        </div>
    </div>










</body>
</html>

