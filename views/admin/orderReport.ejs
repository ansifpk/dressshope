
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Nest Dashboard</title>
        <meta http-equiv="x-ua-compatible" content="ie=edge" />
        <meta name="description" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta property="og:title" content="" />
        <meta property="og:type" content="" />
        <meta property="og:url" content="" />
        <meta property="og:image" content="" />
        <!-- Favicon -->
        <link rel="shortcut icon" type="image/x-icon" href="assets/imgs/theme/favicon.svg" />
        <!-- Template CSS -->
        <link href="assets/css/main.css?v=1.1" rel="stylesheet" type="text/css" />
    </head>

    <body>
        <div class="screen-overlay"></div>
        <aside class="navbar-aside" id="offcanvas_aside">
            <div class="aside-top">
                <a href="index.html" class="brand-wrap">
                    <img src="assets/imgs/theme/logo.svg" class="logo" alt="Nest Dashboard" />
                </a>
                <div>
                    <button class="btn btn-icon btn-aside-minimize"><i class="text-muted material-icons md-menu_open"></i></button>
                </div>
            </div>
            <nav>
                <ul class="menu-aside">
                    <li   class="menu-item "   >
                        <a class="menu-link" href="/admin/dashboard">
                            <i class="icon material-icons md-home"></i>
                            <span class="text">Dashboard</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/dashboard">View Dashboard</a>
                           
                        </div>
                    </li>
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="/admin/products">
                            <i class="icon material-icons md-shopping_bag"></i>
                            <span class="text">Products</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/viewProducts">Product List</a>
                           
                        </div>
                    </li>
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="/admin/viewUser">
                            <i class="icon material-icons md-person"></i>
                            <span class="text">Users</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/viewUser">Users list </a>
                           
                        </div>
                    </li>
                  
                  
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="/adminordersList">
                            <i class="icon material-icons md-monetization_on"></i>
                            <span class="text">View Orders</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/ordersList">Orders</a>
                            
                        </div>
                    </li>
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="#">
                            <i class="icon material-icons md-person"></i>
                            <span class="text">Category</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/category">Category</a>
                           
                        </div>
                    </li>
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="/admin/coupons">
                            <i class="icon material-icons md-local_activity"></i>
                            <span class="text">Coupons</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/coupons">Coupons List</a>
                           
                        </div>
                    </li>
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="">
                            <i class="icon material-icons md-local_offer"></i>
                            <span class="text">Offers</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/offer">Offers List</a>
                            <a href="/admin/referalOffer">Referal Offer</a>
                           
                        </div>
                    </li>
                   <li class="menu-item has-submenu active">
                        <a class="menu-link" href="/admin/orderReport">
                            <i class="icon material-icons md-post_add"></i>
                            <span class="text">Report</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/orderReport">Sales Report</a>
                           
                        </div>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="/admin/logout">
                            <i class="icon material-icons md-login"></i>
                           <span class="text">Logout</span>
                        </a>
                    </li>
                   
                </ul>
                <br />
                <br />
            </nav>
        </aside>
        <main class="main-wrap">
            
            <section class="content-main">
                <div class="content-header">
                    <div>
                        <h2 class="content-title card-title">Sales Report</h2>
                        <p>Whole data about your business here</p>
                    </div>
                    <div id="reports">
                        <a href="/admin/createReport?sDate=<%=sDate%>&&eDate=<%=eDate%>" class="btn btn-primary <%=orderData.length == 0?"disabled":""%>"><i class="text-muted material-icons md-post_add"></i>Create report</a>
                        <a href="/admin/createReportPdf?sDate=<%=sDate%>&&eDate=<%=eDate%>"  class="btn btn-primary <%=orderData.length == 0?"disabled":""%>"><i class="text-muted material-icons md-post_add"></i>Create report in pdf</a> 
                    </div>
                </div>
               
                <div class="row">
                    <div class="row">
                        <div class="col-xl-12 col-lg-12">
                            <div class="row">
                                <div class="card mb-4">
                    <header class="card-header">
                        <div class="row align-items-center">
                            <div class="col-md-4 col-6">
                                <label>Choose Starting Date</label>
                                <input id="sDate" type="date" name="eDate" value="<%=sDate.toLocaleDateString("en-CA")%>" class="form-control" />   
                            </div>
                            <div class="col-md-4 col-6">
                                <label>Choose Ending Date</label>
                                <input id="eDate" type="date" name="eDate" value="<%=eDate.toISOString().split('T')[0]%>" class="form-control" />   
                            </div>
                            <div class="col-md-4 mt-3 col-6">
                            <button class="btn btn-sm font-sm rounded btn-brand" onclick="dateChange()">  Save </button>
                            </div>
                        </div>
                    </header>
                    <div class="card-body">
                        <div class="table-responsive">
                            <div class="table-responsive">
                                <table class="table align-middle table-nowrap mb-0">
                                    <thead class="table-light">
                                        <tr>
                                             
                                            <th class="align-middle" scope="col">Si.No</th>
                                            <th class="align-middle" scope="col">Order Id</th>
                                            <th class="align-middle" scope="col">Billing Name</th>
                                            <th class="align-middle" scope="col">Billing Address</th>
                                            <th class="align-middle" scope="col">Product Name</th>
                                            <th class="align-middle" scope="col">Product Status</th>
                                            <th class="align-middle" scope="col">Payment Method</th>
                                            <th class="align-middle" scope="col">Date</th>
                                            <th class="align-middle" scope="col">Product Quandity</th>
                                            <th class="align-middle" scope="col">Product Price</th>
                                            <th class="align-middle" scope="col">Discount Amount</th>
                                            <th class="align-middle" scope="col">Product Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table">
                                        <%
                                        let total = 0;
                                        let discount = 0;
                                        let gTotal = 0;
                                        %>
                                            <%
                                           if(orderData.length > 0){
                                               
                                               orderData.forEach((order,index) => {
                                                 discount+=order.couponOfferPrice;
                                                 total+=order.products.productTotal;
                                               %>
                                                <tr>
                                                 <td class="text-center"><%=index+1%></td>
                                                 <td class="text-center"><%=order._id%></td>
                                                 <td class="text-center"><%=order.userId.name%></td>
                                                 <td class="text-center"><%=order.products.deliveryAddress.address%></td>
                                                 <td class="text-center"><%=order.products.productId.name %></td>
                                                 <td class="text-center <%=order.products.productStatus == "pending" || order.products.productStatus == "Delivered" ?"badge-soft-success":"badge-soft-danger"%>"><%=order.products.productStatus%></td>
                                                 <td class="text-center"><%=order.products.paymentMethod%></td>
                                                 <td class="text-center"><%=order.createdAt.toLocaleDateString()%></td>
                                                 <td class="text-center"><%=order.products.quandity %></td>
                                                 <td class="text-center"><%=order.products.productId.Price %></td>
                                                 <td class="text-center"><%=order.couponOfferPrice%></td>
                                                 <td class="text-center"><%=order.products.productTotal - order.couponOfferPrice %></td>
                                                </tr>
                                               <%
                                               });    
                                                
                                           }else{%>
                                             <tr>
                                                <td colspan="25">No Orders Are Made In This Time Period!.</td>
                                             </tr>
                                           
                                           <%}
                                           %>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td >Total Amount</td>
                                            <td class="text-center"><%=total%></td>
                                        <tr/>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td >Discount Amount</td>
                                            <td class="text-center"><%=discount%></td>
                                        <tr/>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td >Grand Total</td>
                                            <td class="text-center"><%=total - discount%></td>
                                        <tr/>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                      
                    </div>
                </div>
                            </div>
                        </div>
                    </div>
                </div>
              
             
            </section>
 
            <footer class="main-footer font-xs">
                <div class="row pb-30 pt-15">
                    <div class="col-sm-6">
                        <script>
                            document.write(new Date().getFullYear());
                            
                        </script>
                        
                        &copy; Nest - HTML Ecommerce Template .
                    </div>
                    <div class="col-sm-6">
                        <div class="text-sm-end">All rights reserved</div>
                    </div>
                </div>
            </footer>
        </main>
       <script>
   
   
    function dateChange(){
      const sDate = document.getElementById("sDate").value
      const eDate = document.getElementById("eDate").value

      const reports = document.getElementById("reports")
      fetch(`/admin/dateChange?eDate=${eDate}&&sDate=${sDate}`).then((res)=>res.json())
      .then((res)=>{
           
        if (!res.success) {
             Swal.fire({
                title: "Warning!",
                text: res.message,
                icon: "warning"
             });
            return;
        }else{
           reports.innerHTML = ` <a href="/admin/createReport${res.orderData.length > 0?`?sDate=${sDate}&&eDate=${eDate}`:''}" class="btn btn-primary ${res.orderData.length > 0?"":"disabled"} "><i class="text-muted material-icons md-post_add"></i>Create report</a>
                        <a href="/admin/createReportPdf${res.orderData.length > 0?`?sDate=${sDate}&&eDate=${eDate}`:""}" class="btn btn-primary  ${res.orderData.length > 0?"":"disabled"}"><i class="text-muted material-icons md-post_add"></i>Create report in pdf</a>
                       `
        if(res.orderData.length == 0){
            
             document.getElementById("table").innerHTML = 
             `<tr>
                <td colspan="25">No Orders Are Made In Thid Time Period!.</td>
             </tr>`
        }else{
         let discount = 0;
         let total = 0;
         document.getElementById("table").innerHTML = 
            res.orderData.map((order,index) =>{
                discount+=order.couponOfferPrice;
                total+=order.products.productTotal;
                if (res.orderData.length-1 == index) {
                    return `
                   <tr>
                    <td class="text-center">${index+1}</td>
                    <td class="text-center" >${order._id}</td>
                    <td class="text-center">${order.userId.name}</td>
                    <td class="text-center">${order.products.deliveryAddress.address}</td>
                    <td class="text-center">${order.products.productId.name}</td>
                    <td class="text-center ${order.products.productStatus == "pending" || order.products.productStatus == "Delivered" ?"badge-soft-success":"badge-soft-danger"}">${order.products.productStatus}</td>
                    <td class="text-center">${order.products.paymentMethod}</td>
                    <td class="text-center">${new Date(order.createdAt).toLocaleDateString()}</td>
                    <td class="text-center">${order.products.productId.Price}</td>
                    <td class="text-center">${order.products.quandity}</td>
                    <td class="text-center">${order.couponOfferPrice}</td>
                    <td class="text-center">${order.products.productTotal - order.couponOfferPrice}</td>
                  </tr>
                   <tr>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td >Total Amount</td>
                     <td class="text-center">${total}</td>
                    <tr/>
                    <tr>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td >Discount Amount</td>
                     <td class="text-center">${discount}</td>
                    <tr/>
                    <tr>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td></td>
                     <td >Grand Total</td>
                     <td class="text-center">${total - discount}</td>
                    <tr/>
                  `  
                }
                return `
                   <tr>
                    <td class="text-center">${index+1}</td>
                    <td class="text-center" >${order._id}</td>
                    <td class="text-center">${order.userId.name}</td>
                    <td class="text-center">${order.products.deliveryAddress.address}</td>
                    <td class="text-center">${order.products.productId.name}</td>
                    <td class="text-center ${order.products.productStatus == "pending" || order.products.productStatus == "Delivered" ?"badge-soft-success":"badge-soft-danger"}">${order.products.productStatus}</td>
                    <td class="text-center">${order.products.paymentMethod}</td>
                    <td class="text-center">${new Date(order.createdAt).toLocaleDateString()}</td>
                    <td class="text-center">${order.products.productId.Price}</td>
                    <td class="text-center">${order.products.quandity}</td>
                    <td class="text-center">${order.couponOfferPrice}</td>
                    <td class="text-center">${order.products.productTotal - order.couponOfferPrice}</td>
                  </tr>
                  `  
            }).join("")

        }

    }
            return
         reports.innerHTML = ` <a href="/admin/createReport" class="btn btn-primary ${data.array.length > 0?"":"disabled"} "><i class="text-muted material-icons md-post_add"></i>Create report</a>
                        <a href="/admin/createReportPdf" class="btn btn-primary  ${data.array.length > 0?"":"disabled"}"><i class="text-muted material-icons md-post_add"></i>Create report in pdf</a>
                       `
      })
    }
        
   
            
       </script>
      
        <script src="assets/js/vendors/jquery-3.6.0.min.js"></script>
        <script src="assets/js/vendors/bootstrap.bundle.min.js"></script>
        <script src="assets/js/vendors/select2.min.js"></script>
        <script src="assets/js/vendors/perfect-scrollbar.js"></script>
        <script src="assets/js/vendors/jquery.fullscreen.min.js"></script>
        <script src="assets/js/vendors/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <!-- Main Script -->
        <script src="assets/js/main.js?v=1.1" type="text/javascript"></script>
        <script src="assets/js/custom-chart.js" type="text/javascript"></script>
       
       
    </body>
</html>
